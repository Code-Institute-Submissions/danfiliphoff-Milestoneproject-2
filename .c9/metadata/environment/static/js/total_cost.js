{"changed":true,"filter":false,"title":"total_cost.js","tooltip":"/static/js/total_cost.js","value":"/*steg: \n1. skapa HTML.\n2. skapa function\n3.lägg till function under make graph*/\n\n/*väntar med att skapa graf tills data är laddat*/\nqueue()\n    .defer(d3.csv, \"data/total_cost.csv\")\n    .await(makeTotalCostGraps);\n    \nfunction makeTotalCostGraps(error, totalCost){\n    \n    var parseDate = d3.time.format(\"%Y-%m-%d\").parse;\n        totalCost.forEach(function(d){\n            d.PaymentDate = parseDate(d.PaymentDate);\n        });\n\n    \n   var ndx=crossfilter(totalCost);\n   makePie(ndx);\n   TotalLineGraph(ndx);\n   StackedBarChartTotalCost(ndx);\n   dc.renderAll();\n}\n   \nfunction TotalLineGraph(ndx) {  \n    var payment_date_dim = ndx.dimension(dc.pluck(\"PaymentDate\"));  \n    var total_spend_per_date = payment_date_dim.group().reduceSum(dc.pluck('Sum'));\n    \n    var minDate = payment_date_dim.bottom(1)[0].PaymentDate;\n    var maxDate = payment_date_dim.top(1)[0].PaymentDate;\n  \n    dc.lineChart('#total-cost-line-graph')  \n        .width(1000)  \n        .height(300)  \n        .margins({top: 10, right: 150, bottom: 30, left: 150})\n        .dimension(payment_date_dim)  \n        .group(total_spend_per_date)  \n        .transitionDuration(500)  \n        .x(d3.time.scale().domain([minDate,maxDate]))  \n        .xAxisLabel(\"Month\")  \n        .yAxis().ticks(8);\n} \n    \n/*skapar graf och hämtar data*/\nfunction StackedBarChartTotalCost(ndx){\n    var payment_date_dim_bar = ndx.dimension(dc.pluck(\"PaymentDate\"));\n    var minDate = payment_date_dim_bar.bottom(1)[0].PaymentDate;\n    var maxDate = payment_date_dim_bar.top(1)[0].PaymentDate;\n    var NettpayByMonth = payment_date_dim_bar.group().reduceSum(function (d) {\n            if (d.Type === 'Nettpay') {\n                return +d.Sum;\n            } else {\n                return 0;\n            }\n        });\n    \n    var TaxesByMonth = payment_date_dim_bar.group().reduceSum(function (d) {\n            if (d.Type === 'Taxes') {\n                return +d.Sum;\n            } else {\n                return 0;\n            }\n        });\n        \n    var SocialSecurityFeesByMonth = payment_date_dim_bar.group().reduceSum(function (d) {\n            if (d.Type === 'Social Security Fees') {\n                return +d.Sum;\n            } else {\n                return 0;\n            }\n        });\n   \n    dc.barChart('#total-cost-stacked-bar-chart')\n            .width(1500)\n            .height(800)\n            .margins({top: 10, left: 80, right: 1, bottom: 50})\n            .dimension(payment_date_dim_bar)\n            .group(NettpayByMonth, \"Nettpay\")\n            .stack(TaxesByMonth, \"Taxes\")\n            .stack(SocialSecurityFeesByMonth, \"Sociala\")\n            .renderLabel(true)/*gets total label for whole bar*/\n            .elasticX(true)\n            .xAxisPadding(10)\n            .gap(15)\n            .centerBar(true)\n            .x(d3.time.scale().domain([minDate,maxDate]))\n            .xUnits(d3.time.months)\n           /* .barPadding(0.3)/*adjusts with of each bar*/\n            .legend(dc.legend().x(420).y(0).itemHeight(15).gap(5))\n            .on('renderlet', function (chart) {\n                //Check if labels exist\n                var gLabels = chart.select(\".labels\");\n                if (gLabels.empty()){\n                    gLabels = chart.select(\".chart-body\").append('g').classed('labels', true);\n                }\n            \n                var gLabelsData = gLabels.selectAll(\"text\").data(chart.selectAll(\".bar\")[0]);\n                gLabelsData.exit().remove(); //Remove unused elements\n                gLabelsData.enter().append(\"text\") //Add new elements\n                gLabelsData\n                .attr('text-anchor', 'middle')\n                .attr('fill', 'white')\n                .text(function(d){\n                    text_object =  d3.select(d).datum().y\n                    console.log(text_object)\n                    return text_object\n                })\n                .attr('x', function(d){ \n                    return +d.getAttribute('x') + (d.getAttribute('width')/2); \n                })\n                .attr('y', function(d){ return +d.getAttribute('y') + 15; })\n                .attr('style', function(d){\n                    if (+d.getAttribute('height') < 18) return \"display:none\";\n                });\n            \n            });\n}\n\n\n  \n\n\n\nfunction makePie(ndx) {\n    var type_dim = ndx.dimension(dc.pluck(\"Type\"));\n    var total_cost_pie_chart = type_dim.group().reduceSum(dc.pluck('Sum'));\n    \n\n    dc.pieChart('#total-cost-pie-chart')\n          \n        .height(1000)\n        .radius(200)\n        .innerRadius(100)\n        .transitionDuration(1500)\n        .dimension(type_dim)\n        .group(total_cost_pie_chart)\n        .externalLabels(50)\n        /*8129071: har summerat ihopp för hand vill hitta kod som summerar ihopp åt mig. \n        *100)/100 i slutet av formeln är för att få med 2 decimal tecken i procenten\n        */\n        .label(function(d){return d.key + \" \" + d.value + \" \" + \"KR (\" +  Math.round((d.value/(8129071/100))*100)/100 + \"%)\"})\n        .renderLabel(true);\n}\n\n","undoManager":{"mark":4,"position":8,"stack":[[{"start":{"row":109,"column":32},"end":{"row":109,"column":33},"action":"remove","lines":["e"],"id":1},{"start":{"row":109,"column":31},"end":{"row":109,"column":32},"action":"remove","lines":["m"]},{"start":{"row":109,"column":30},"end":{"row":109,"column":31},"action":"remove","lines":["i"]},{"start":{"row":109,"column":29},"end":{"row":109,"column":30},"action":"remove","lines":["T"]},{"start":{"row":109,"column":28},"end":{"row":109,"column":29},"action":"remove","lines":["-"]},{"start":{"row":109,"column":27},"end":{"row":109,"column":28},"action":"remove","lines":["r"]},{"start":{"row":109,"column":26},"end":{"row":109,"column":27},"action":"remove","lines":["e"]},{"start":{"row":109,"column":25},"end":{"row":109,"column":26},"action":"remove","lines":["v"]},{"start":{"row":109,"column":24},"end":{"row":109,"column":25},"action":"remove","lines":["O"]},{"start":{"row":109,"column":23},"end":{"row":109,"column":24},"action":"remove","lines":["-"]},{"start":{"row":109,"column":22},"end":{"row":109,"column":23},"action":"remove","lines":["t"]},{"start":{"row":109,"column":21},"end":{"row":109,"column":22},"action":"remove","lines":["s"]},{"start":{"row":109,"column":20},"end":{"row":109,"column":21},"action":"remove","lines":["o"]},{"start":{"row":109,"column":19},"end":{"row":109,"column":20},"action":"remove","lines":["C"]}],[{"start":{"row":109,"column":19},"end":{"row":109,"column":40},"action":"insert","lines":["total-cost-line-graph"],"id":2}],[{"start":{"row":55,"column":45},"end":{"row":55,"column":46},"action":"remove","lines":["t"],"id":3},{"start":{"row":55,"column":44},"end":{"row":55,"column":45},"action":"remove","lines":["r"]},{"start":{"row":55,"column":43},"end":{"row":55,"column":44},"action":"remove","lines":["a"]},{"start":{"row":55,"column":42},"end":{"row":55,"column":43},"action":"remove","lines":["h"]},{"start":{"row":55,"column":41},"end":{"row":55,"column":42},"action":"remove","lines":["c"]},{"start":{"row":55,"column":40},"end":{"row":55,"column":41},"action":"remove","lines":["-"]},{"start":{"row":55,"column":39},"end":{"row":55,"column":40},"action":"remove","lines":["r"]},{"start":{"row":55,"column":38},"end":{"row":55,"column":39},"action":"remove","lines":["a"]},{"start":{"row":55,"column":37},"end":{"row":55,"column":38},"action":"remove","lines":["b"]},{"start":{"row":55,"column":36},"end":{"row":55,"column":37},"action":"remove","lines":["-"]},{"start":{"row":55,"column":35},"end":{"row":55,"column":36},"action":"remove","lines":["d"]},{"start":{"row":55,"column":34},"end":{"row":55,"column":35},"action":"remove","lines":["e"]},{"start":{"row":55,"column":33},"end":{"row":55,"column":34},"action":"remove","lines":["k"]},{"start":{"row":55,"column":32},"end":{"row":55,"column":33},"action":"remove","lines":["c"]},{"start":{"row":55,"column":31},"end":{"row":55,"column":32},"action":"remove","lines":["a"]},{"start":{"row":55,"column":30},"end":{"row":55,"column":31},"action":"remove","lines":["t"]},{"start":{"row":55,"column":29},"end":{"row":55,"column":30},"action":"remove","lines":["s"]},{"start":{"row":55,"column":28},"end":{"row":55,"column":29},"action":"remove","lines":["-"]},{"start":{"row":55,"column":27},"end":{"row":55,"column":28},"action":"remove","lines":["t"]},{"start":{"row":55,"column":26},"end":{"row":55,"column":27},"action":"remove","lines":["s"]},{"start":{"row":55,"column":25},"end":{"row":55,"column":26},"action":"remove","lines":["o"]},{"start":{"row":55,"column":24},"end":{"row":55,"column":25},"action":"remove","lines":["c"]},{"start":{"row":55,"column":23},"end":{"row":55,"column":24},"action":"remove","lines":["-"]},{"start":{"row":55,"column":22},"end":{"row":55,"column":23},"action":"remove","lines":["l"]},{"start":{"row":55,"column":21},"end":{"row":55,"column":22},"action":"remove","lines":["a"]},{"start":{"row":55,"column":20},"end":{"row":55,"column":21},"action":"remove","lines":["t"]},{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":["o"]}],[{"start":{"row":55,"column":18},"end":{"row":55,"column":19},"action":"remove","lines":["t"],"id":4}],[{"start":{"row":55,"column":18},"end":{"row":55,"column":46},"action":"insert","lines":["total-cost-stacked-bar-chart"],"id":5}],[{"start":{"row":102,"column":0},"end":{"row":119,"column":1},"action":"remove","lines":["function TotalLineGraph(ndx) {  ","    var payment_date_dim = ndx.dimension(dc.pluck(\"PaymentDate\"));  ","    var total_spend_per_date = payment_date_dim.group().reduceSum(dc.pluck('Sum'));","    ","    var minDate = payment_date_dim.bottom(1)[0].PaymentDate;","    var maxDate = payment_date_dim.top(1)[0].PaymentDate;","  ","    dc.lineChart('#total-cost-line-graph')  ","        .width(1000)  ","        .height(300)  ","        .margins({top: 10, right: 150, bottom: 30, left: 150})","        .dimension(payment_date_dim)  ","        .group(total_spend_per_date)  ","        .transitionDuration(500)  ","        .x(d3.time.scale().domain([minDate,maxDate]))  ","        .xAxisLabel(\"Month\")  ","        .yAxis().ticks(8);","}"],"id":6}],[{"start":{"row":24,"column":3},"end":{"row":25,"column":0},"action":"insert","lines":["",""],"id":7},{"start":{"row":25,"column":0},"end":{"row":25,"column":3},"action":"insert","lines":["   "]}],[{"start":{"row":25,"column":2},"end":{"row":25,"column":3},"action":"remove","lines":[" "],"id":8},{"start":{"row":25,"column":1},"end":{"row":25,"column":2},"action":"remove","lines":[" "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":1},"action":"remove","lines":[" "]}],[{"start":{"row":25,"column":0},"end":{"row":42,"column":1},"action":"insert","lines":["function TotalLineGraph(ndx) {  ","    var payment_date_dim = ndx.dimension(dc.pluck(\"PaymentDate\"));  ","    var total_spend_per_date = payment_date_dim.group().reduceSum(dc.pluck('Sum'));","    ","    var minDate = payment_date_dim.bottom(1)[0].PaymentDate;","    var maxDate = payment_date_dim.top(1)[0].PaymentDate;","  ","    dc.lineChart('#total-cost-line-graph')  ","        .width(1000)  ","        .height(300)  ","        .margins({top: 10, right: 150, bottom: 30, left: 150})","        .dimension(payment_date_dim)  ","        .group(total_spend_per_date)  ","        .transitionDuration(500)  ","        .x(d3.time.scale().domain([minDate,maxDate]))  ","        .xAxisLabel(\"Month\")  ","        .yAxis().ticks(8);","}"],"id":9}]]},"ace":{"folds":[],"scrolltop":337.5,"scrollleft":0,"selection":{"start":{"row":46,"column":43},"end":{"row":46,"column":43},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":23,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1567442073668}